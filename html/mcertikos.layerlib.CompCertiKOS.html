<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>mcertikos.layerlib.CompCertiKOS</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library mcertikos.layerlib.CompCertiKOS</h1>

<div class="code">
</div>

<div class="doc">
The CompCertiKOS verified compiler, from CompCertX ClightX to per-function/module CertiKOS LAsm. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="library">SeparateCompiler</span>.<br/>
<span class="id" title="keyword">Require</span> <a class="idref" href="mcertikos.layerlib.LAsmgen.html#"><span class="id" title="library">LAsmgen</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">Errors</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">AST</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ComposePasses</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_rtl_program"><span class="id" title="definition">transf_rtl_program</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">fenv</span>: <span class="id" title="definition">Inlining.funenv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span>: <span class="id" title="definition">RTL.program</span>): <span class="id" title="inductive">res</span> <a class="idref" href="mcertikos.layerlib.LAsm.html#program"><span class="id" title="definition">LAsm.program</span></a> := <br/>
&nbsp;&nbsp;<span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">@@@</span> <span class="id" title="notation">(</span><span class="id" title="definition">SeparateCompiler.transf_rtl_program</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">@@</span> <a class="idref" href="mcertikos.layerlib.LAsmgen.html#transf_program"><span class="id" title="definition">LAsmgen.transf_program</span></a>.<br/>

<br/>
</div>

<div class="doc">
Now, let's prove that our compiler is a per-function compiler 
    (given an inlining parameter, which we do not care about how
    it is computed). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_rtl_fundef"><span class="id" title="definition">transf_rtl_fundef</span></a> (<span class="id" title="var">fenv</span>: <span class="id" title="definition">Inlining.funenv</span>): <br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">f</span>: <span class="id" title="definition">RTL.fundef</span>), <span class="id" title="inductive">res</span> <a class="idref" href="mcertikos.layerlib.LAsm.html#fundef"><span class="id" title="definition">LAsm.fundef</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="definition">SeparateCompiler.transf_rtl_fundef</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">;&gt;</span> <a class="idref" href="mcertikos.layerlib.LAsmgen.html#transf_fundef"><span class="id" title="definition">LAsmgen.transf_fundef</span></a>.<br/>

<br/>
</div>

<div class="doc">
Auxiliary functions. These functions should be used only in proofs, and should not be extracted,
    because if the computation of <span class="inlinecode"><span class="id" title="var">fenv</span></span> is based on <span class="inlinecode"><span class="id" title="var">transf_clight_fundef_to_rtl</span></span>, then
    using <span class="inlinecode"><span class="id" title="var">transf_clight_fundef_to_lasm&acute;</span></span> will call <span class="inlinecode"><span class="id" title="var">transf_clight_fundef_to_rtl</span></span> twice. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_clight_fundef&acute;"><span class="id" title="definition">transf_clight_fundef&acute;</span></a> (<span class="id" title="var">fenv</span>: <span class="id" title="definition">Inlining.funenv</span>):<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">f</span>: <span class="id" title="inductive">Clight.fundef</span>), <span class="id" title="inductive">res</span> <a class="idref" href="mcertikos.layerlib.LAsm.html#fundef"><span class="id" title="definition">LAsm.fundef</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="definition">SeparateCompiler.transf_clight_fundef&acute;</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">;&gt;</span> <a class="idref" href="mcertikos.layerlib.LAsmgen.html#transf_fundef"><span class="id" title="definition">LAsmgen.transf_fundef</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_clight_program&acute;"><span class="id" title="definition">transf_clight_program&acute;</span></a> (<span class="id" title="var">fenv</span>: <span class="id" title="definition">Inlining.funenv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span>: <span class="id" title="definition">Clight.program</span>): <span class="id" title="inductive">res</span> <a class="idref" href="mcertikos.layerlib.LAsm.html#program"><span class="id" title="definition">LAsm.program</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">@@@</span> <span class="id" title="notation">(</span><span class="id" title="definition">SeparateCompiler.transf_clight_program&acute;</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">@@</span> <a class="idref" href="mcertikos.layerlib.LAsmgen.html#transf_program"><span class="id" title="definition">LAsmgen.transf_program</span></a>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="transf_rtl_fundef_to_program"><span class="id" title="lemma">transf_rtl_fundef_to_program</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">fenv</span> <span class="id" title="var">p</span> <span class="id" title="var">tp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">transform_partial_program</span> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_fundef"><span class="id" title="definition">transf_rtl_fundef</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a>) <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tp"><span class="id" title="variable">tp</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_program"><span class="id" title="definition">transf_rtl_program</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tp"><span class="id" title="variable">tp</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_fundef"><span class="id" title="definition">transf_rtl_fundef</span></a>, <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_program"><span class="id" title="definition">transf_rtl_program</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">SeparateCompiler.compose_elim</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="lemma">apply_partial_intro</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="lemma">SeparateCompiler.transf_rtl_fundef_to_program</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="transf_clight_fundef_to_program&acute;"><span class="id" title="lemma">transf_clight_fundef_to_program&acute;</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">fenv</span> <span class="id" title="var">p</span> <span class="id" title="var">tp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">transform_partial_program2</span> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_fundef&acute;"><span class="id" title="definition">transf_clight_fundef&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a>) <span class="id" title="definition">Cshmgen.transl_globvar</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tp"><span class="id" title="variable">tp</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_program&acute;"><span class="id" title="definition">transf_clight_program&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tp"><span class="id" title="variable">tp</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_program&acute;"><span class="id" title="definition">transf_clight_program&acute;</span></a>, <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_fundef&acute;"><span class="id" title="definition">transf_clight_fundef&acute;</span></a>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="definition">Cshmgen.transl_globvar</span>) <span class="id" title="keyword">with</span> (<span class="id" title="definition">Cshmgen.transl_globvar</span> <span class="id" title="notation">;;;</span> <span class="id" title="notation">(</span><span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> ⇒ <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#v"><span class="id" title="variable">v</span></a><span class="id" title="notation">)</span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="lemma">transform_partial_program2_compose_in_out</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">SeparateCompiler.compose_elim</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">type</span> <span class="id" title="var">of</span> <span class="id" title="var">Hbc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="definition">transform_partial_program2</span> ?<span class="id" title="var">tf</span> ?<span class="id" title="var">tv</span> ?<span class="id" title="var">b</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<span class="id" title="definition">transform_partial_program2</span> <span class="id" title="var">tf</span> <span class="id" title="var">tv</span> <span class="id" title="var">b</span>) <span class="id" title="keyword">with</span> (<span class="id" title="definition">transform_partial_program</span> <span class="id" title="var">tf</span> <span class="id" title="var">b</span>) <span class="id" title="keyword">in</span> <span class="id" title="var">Hbc</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">apply_partial</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="lemma">SeparateCompiler.transf_clight_fundef_to_program&acute;</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">transform_program_partial_program</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hbc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hbc</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="transf_rtl_program_to_fundef"><span class="id" title="lemma">transf_rtl_program_to_fundef</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">fenv</span> <span class="id" title="var">p</span> <span class="id" title="var">tp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_program"><span class="id" title="definition">transf_rtl_program</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tp"><span class="id" title="variable">tp</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">transform_partial_program</span> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_fundef"><span class="id" title="definition">transf_rtl_fundef</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a>) <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tp"><span class="id" title="variable">tp</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_program"><span class="id" title="definition">transf_rtl_program</span></a>, <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_fundef"><span class="id" title="definition">transf_rtl_fundef</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">SeparateCompiler.apply_elim</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">SeparateCompiler.compose_intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="lemma">SeparateCompiler.transf_rtl_program_to_fundef</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="transf_clight_program_to_fundef&acute;"><span class="id" title="lemma">transf_clight_program_to_fundef&acute;</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">fenv</span> <span class="id" title="var">p</span> <span class="id" title="var">tp</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_program&acute;"><span class="id" title="definition">transf_clight_program&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tp"><span class="id" title="variable">tp</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">transform_partial_program2</span> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_fundef&acute;"><span class="id" title="definition">transf_clight_fundef&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a>) <span class="id" title="definition">Cshmgen.transl_globvar</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tp"><span class="id" title="variable">tp</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_program&acute;"><span class="id" title="definition">transf_clight_program&acute;</span></a>, <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_fundef&acute;"><span class="id" title="definition">transf_clight_fundef&acute;</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">SeparateCompiler.apply_elim</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="definition">Cshmgen.transl_globvar</span>) <span class="id" title="keyword">with</span> (<span class="id" title="definition">Cshmgen.transl_globvar</span> <span class="id" title="notation">;;;</span> <span class="id" title="notation">(</span><span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> ⇒ <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#v"><span class="id" title="variable">v</span></a><span class="id" title="notation">)</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="lemma">transform_partial_program2_compose_out_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="lemma">compose_partial_intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="lemma">SeparateCompiler.transf_clight_program_to_fundef&acute;</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="lemma">transform_program_partial_program</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Now, let's prove that our compiler does not change well-typed external functions 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="transf_clight_fundef_external"><span class="id" title="lemma">transf_clight_fundef_external</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">fenv</span> <span class="id" title="var">ef</span> <span class="id" title="var">tl</span> <span class="id" title="var">ty</span> <span class="id" title="var">cc</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">ef_sig</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#ef"><span class="id" title="variable">ef</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="definition">Ctypes.signature_of_type</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tl"><span class="id" title="variable">tl</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#ty"><span class="id" title="variable">ty</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#cc"><span class="id" title="variable">cc</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_fundef&acute;"><span class="id" title="definition">transf_clight_fundef&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a> (<span class="id" title="constructor">Clight.External</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#ef"><span class="id" title="variable">ef</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tl"><span class="id" title="variable">tl</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#ty"><span class="id" title="variable">ty</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#cc"><span class="id" title="variable">cc</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> (<span class="id" title="constructor">AST.External</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#ef"><span class="id" title="variable">ef</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_fundef&acute;"><span class="id" title="definition">transf_clight_fundef&acute;</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">compose_total_right</span>, <span class="id" title="definition">apply_total</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="lemma">SeparateCompiler.transf_clight_fundef_external</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Now, let's prove that our compiler is a per-function compiler for internal functions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_rtl_function"><span class="id" title="definition">transf_rtl_function</span></a> <span class="id" title="var">fenv</span>: <span class="id" title="keyword">∀</span> (<span class="id" title="var">p</span>: <span class="id" title="record">RTL.function</span>), <span class="id" title="inductive">res</span> <a class="idref" href="mcertikos.layerlib.LAsm.html#function"><span class="id" title="record">LAsm.function</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="definition">SeparateCompiler.transf_rtl_function</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">;&gt;</span> <a class="idref" href="mcertikos.layerlib.LAsmgen.html#transf_function"><span class="id" title="definition">LAsmgen.transf_function</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_clight_function&acute;"><span class="id" title="definition">transf_clight_function&acute;</span></a> <span class="id" title="var">fenv</span>: <span class="id" title="keyword">∀</span> (<span class="id" title="var">p</span>: <span class="id" title="record">Clight.function</span>), <span class="id" title="inductive">res</span> <a class="idref" href="mcertikos.layerlib.LAsm.html#function"><span class="id" title="record">LAsm.function</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="definition">SeparateCompiler.transf_clight_function&acute;</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">;&gt;</span> <a class="idref" href="mcertikos.layerlib.LAsmgen.html#transf_function"><span class="id" title="definition">LAsmgen.transf_function</span></a>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <a name="transf_clight_fundef_internal"><span class="id" title="lemma">transf_clight_fundef_internal</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">fenv</span> <span class="id" title="var">f</span> <span class="id" title="var">tf</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_function&acute;"><span class="id" title="definition">transf_clight_function&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tf"><span class="id" title="variable">tf</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_fundef&acute;"><span class="id" title="definition">transf_clight_fundef&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a> (<span class="id" title="constructor">Clight.Internal</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#f"><span class="id" title="variable">f</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> (<span class="id" title="constructor">AST.Internal</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#tf"><span class="id" title="variable">tf</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_function&acute;"><span class="id" title="definition">transf_clight_function&acute;</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">SeparateCompiler.compose_elim</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_fundef&acute;"><span class="id" title="definition">transf_clight_fundef&acute;</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">compose_total_right</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">apply_total</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="lemma">SeparateCompiler.transf_clight_fundef_internal</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Per-module compiler (uses the concrete implementation of modules) 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Coqlib</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Functor</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Monad</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">OptionMonad</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">ErrorMonad</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">PTrees</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">PTreeModules</span>.<br/>

<br/>
</div>

<div class="doc">
How to use CompCertX to compile modules from Clight to Asm. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_nzdef"><span class="id" title="definition">transf_nzdef</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">transf_function</span>: <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#A"><span class="id" title="variable">A</span></a> → <span class="id" title="inductive">res</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#B"><span class="id" title="variable">B</span></a>):<br/>
&nbsp;&nbsp;<span class="id" title="inductive">res</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#A"><span class="id" title="variable">A</span></a> → <span class="id" title="inductive">res</span> (<span class="id" title="inductive">res</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#B"><span class="id" title="variable">B</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">z</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="notation">&lt;-</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#z"><span class="id" title="variable">z</span></a><span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b</span> <span class="id" title="notation">&lt;-</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_function"><span class="id" title="variable">transf_function</span></a> <span class="id" title="var">a</span><span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="constructor">OK</span> (<span class="id" title="constructor">OK</span> <span class="id" title="var">b</span>).<br/>

<br/>
</div>

<div class="doc">
We first construct the <span class="inlinecode"><span class="id" title="var">fenv</span></span> function map for function
inlining, from an RTL "module" (PTree of RTL internal function
definitions).

<div class="paragraph"> </div>

The following definition selects a function for inlining.
 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="select_to_inline"><span class="id" title="definition">select_to_inline</span></a> <span class="id" title="var">i</span> (<span class="id" title="var">z</span>: <span class="id" title="inductive">res</span> <span class="id" title="record">RTL.function</span>): <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <span class="id" title="record">RTL.function</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="definition">fallback</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> <span class="id" title="notation">&lt;-</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#z"><span class="id" title="variable">z</span></a><span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="constructor">OK</span> (<span class="id" title="keyword">if</span> <span class="id" title="axiom">Inlining.should_inline</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <span class="id" title="var">f</span> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">f</span> <span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>)).<br/>

<br/>
</div>

<div class="doc">
Thanks to this definition, we can now build the inlining environment. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="fenv"><span class="id" title="definition">fenv</span></a> (<span class="id" title="var">M</span>: <span class="id" title="definition">PTree.t</span> (<span class="id" title="inductive">res</span> <span class="id" title="record">RTL.function</span>)): <span class="id" title="definition">Inlining.funenv</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="definition">PTree.map_option</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#select_to_inline"><span class="id" title="definition">select_to_inline</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a>.<br/>

<br/>
</div>

<div class="doc">
Finally, we can define the CompCertX compiler on Clight modules. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_module"><span class="id" title="definition">transf_module</span></a> (<span class="id" title="var">M</span>: <span class="id" title="definition">ptree_module</span> <span class="id" title="record">Clight.function</span> (<span class="id" title="record">globvar</span> <span class="id" title="inductive">Ctypes.type</span>)):<br/>
&nbsp;&nbsp;<span class="id" title="inductive">res</span> (<span class="id" title="definition">ptree_module</span> <a class="idref" href="mcertikos.layerlib.LAsm.html#function"><span class="id" title="record">LAsm.function</span></a> (<span class="id" title="record">AST.globvar</span> <span class="id" title="inductive">Ctypes.type</span>)) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">Mt1</span> <span class="id" title="notation">&lt;-</span> <span class="id" title="definition">PTree.map_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_nzdef"><span class="id" title="definition">transf_nzdef</span></a> <span class="id" title="definition">SeparateCompiler.transf_clight_function_to_rtl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a>)<span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Mt2</span> <span class="id" title="notation">&lt;-</span> <span class="id" title="definition">PTree.map_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_nzdef"><span class="id" title="definition">transf_nzdef</span></a> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_function"><span class="id" title="definition">transf_rtl_function</span></a> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="definition">fenv</span></a> <span class="id" title="var">Mt1</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Mt1</span><span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;<span class="id" title="method">ret</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><span class="id" title="var">Mt2</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
For the purpose of the proof, we can rewrite our compiler as follows: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="fenv_of_clight"><span class="id" title="definition">fenv_of_clight</span></a> (<span class="id" title="var">M</span>:<span class="id" title="definition">ptree_module</span> <span class="id" title="record">Clight.function</span> (<span class="id" title="record">globvar</span> <span class="id" title="inductive">Ctypes.type</span>)):<br/>
&nbsp;&nbsp;<span class="id" title="inductive">res</span> <span class="id" title="definition">Inlining.funenv</span> := <br/>
&nbsp;&nbsp;<span class="id" title="var">Mt1</span> <span class="id" title="notation">&lt;-</span> <span class="id" title="definition">PTree.map_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_nzdef"><span class="id" title="definition">transf_nzdef</span></a> <span class="id" title="definition">SeparateCompiler.transf_clight_function_to_rtl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a>)<span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;<span class="id" title="constructor">OK</span> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="definition">fenv</span></a> <span class="id" title="var">Mt1</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_module_with_fenv"><span class="id" title="definition">transf_module_with_fenv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">fenv</span>: <span class="id" title="definition">Inlining.funenv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">M</span>: <span class="id" title="definition">ptree_module</span> <span class="id" title="record">Clight.function</span> (<span class="id" title="record">AST.globvar</span> <span class="id" title="inductive">Ctypes.type</span>))<br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Mt</span> <span class="id" title="notation">&lt;-</span> <span class="id" title="definition">PTree.map_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_nzdef"><span class="id" title="definition">transf_nzdef</span></a> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_function&acute;"><span class="id" title="definition">transf_clight_function&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a>)<span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="constructor">OK</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><span class="id" title="var">Mt</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="transf_module&acute;"><span class="id" title="definition">transf_module&acute;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">M</span>: <span class="id" title="definition">ptree_module</span> <span class="id" title="record">Clight.function</span> (<span class="id" title="record">AST.globvar</span> <span class="id" title="inductive">Ctypes.type</span>)) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv_of_clight"><span class="id" title="definition">fenv_of_clight</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="constructor">OK</span> <span class="id" title="var">fenv</span> ⇒ <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_with_fenv"><span class="id" title="definition">transf_module_with_fenv</span></a> <span class="id" title="var">fenv</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="constructor">Error</span> <span class="id" title="var">msg</span> ⇒ <span class="id" title="constructor">Error</span> <span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="transf_module_eq_module&acute;_ok"><span class="id" title="lemma">transf_module_eq_module&acute;_ok</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">M</span> <span class="id" title="var">M&acute;</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module"><span class="id" title="definition">transf_module</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M&acute;"><span class="id" title="variable">M&acute;</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module&acute;"><span class="id" title="definition">transf_module&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M&acute;"><span class="id" title="variable">M&acute;</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module"><span class="id" title="definition">transf_module</span></a>, <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module&acute;"><span class="id" title="definition">transf_module&acute;</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_with_fenv"><span class="id" title="definition">transf_module_with_fenv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv_of_clight"><span class="id" title="definition">fenv_of_clight</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">PTree.map_error</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:?; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="var">monad_norm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">inv_monad</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="lemma">PTree.map_compose_ok</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="lemma">PTree.map_compose_ok</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_nzdef"><span class="id" title="definition">transf_nzdef</span></a> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_function&acute;"><span class="id" title="definition">transf_clight_function&acute;</span></a> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="definition">fenv</span></a> <span class="id" title="var">t</span>))) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Heqr</span> <span class="id" title="var">H2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">exploit</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span> <span class="id" title="keyword">as</span> [|]; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_function&acute;"><span class="id" title="definition">transf_clight_function&acute;</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">SeparateCompiler.transf_clight_function&acute;</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">ComposePasses.compose_partial</span>, <span class="id" title="definition">ComposePasses.compose_total_right</span>, <span class="id" title="definition">ComposePasses.apply_partial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_nzdef"><span class="id" title="definition">transf_nzdef</span></a>, <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_rtl_function"><span class="id" title="definition">transf_rtl_function</span></a> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">SeparateCompiler.transf_clight_function_to_rtl</span> <span class="id" title="var">f</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> 2; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Local</span>&nbsp;<span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">ptree_module_ops</span>.<br/>
<span class="id" title="keyword">Local</span>&nbsp;<span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">ptree_module_prf</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="get_module_function_transf_some_strong"><span class="id" title="lemma">get_module_function_transf_some_strong</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module"><span class="id" title="definition">transf_module</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">i</span>: <span class="id" title="definition">ident</span>) <span class="id" title="var">f1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_function</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#f1"><span class="id" title="variable">f1</span></a>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">∃</span></a> <span class="id" title="var">f2</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_function</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#f2"><span class="id" title="variable">f2</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">∧</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">∃</span></a> <span class="id" title="var">fenv</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_clight_function&acute;"><span class="id" title="definition">transf_clight_function&acute;</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv"><span class="id" title="variable">fenv</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#f1"><span class="id" title="variable">f1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#f2"><span class="id" title="variable">f2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">until</span> <span class="id" title="var">M2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span>  <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_eq_module&acute;_ok"><span class="id" title="lemma">transf_module_eq_module&acute;_ok</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module&acute;"><span class="id" title="definition">transf_module&acute;</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv_of_clight"><span class="id" title="definition">fenv_of_clight</span></a> <span class="id" title="var">M1</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> <span class="id" title="var">f1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_with_fenv"><span class="id" title="definition">transf_module_with_fenv</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">inv_monad</span> <span class="id" title="var">TRANSF</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="lemma">PTree.gmap_error_ok</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">i</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Transparent</span> <span class="id" title="instance">ptree_module_ops</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">ptree_module_function</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="notation">(</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <span class="id" title="var">M1</span><span class="id" title="notation">)</span> <span class="id" title="notation">!</span> <span class="id" title="var">i</span>) <span class="id" title="keyword">as</span> [[|]|]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_nzdef"><span class="id" title="definition">transf_nzdef</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">f&acute;</span> &amp; <span class="id" title="var">Hf&acute;1</span> &amp; <span class="id" title="var">Hf&acute;2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">inv_monad</span> <span class="id" title="var">Hf&acute;1</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> 1; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hf&acute;2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;× <span class="id" title="tactic">∃</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="get_module_function_transf_some"><span class="id" title="lemma">get_module_function_transf_some</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module"><span class="id" title="definition">transf_module</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">i</span>: <span class="id" title="definition">ident</span>) <span class="id" title="var">f1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_function</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#f1"><span class="id" title="variable">f1</span></a>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">∃</span></a> <span class="id" title="var">f2</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_function</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#f2"><span class="id" title="variable">f2</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">exploit</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#get_module_function_transf_some_strong"><span class="id" title="lemma">get_module_function_transf_some_strong</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> 1 <span class="id" title="keyword">as</span> (? &amp; ? &amp; ?) .<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="get_module_function_transf_none"><span class="id" title="lemma">get_module_function_transf_none</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module"><span class="id" title="definition">transf_module</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">i</span>: <span class="id" title="definition">ident</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_function</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_function</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">until</span> <span class="id" title="var">M2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span>  <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_eq_module&acute;_ok"><span class="id" title="lemma">transf_module_eq_module&acute;_ok</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module&acute;"><span class="id" title="definition">transf_module&acute;</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv_of_clight"><span class="id" title="definition">fenv_of_clight</span></a> <span class="id" title="var">M1</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_with_fenv"><span class="id" title="definition">transf_module_with_fenv</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">inv_monad</span> <span class="id" title="var">TRANSF</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="lemma">PTree.gmap_error_ok</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">i</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Transparent</span> <span class="id" title="instance">ptree_module_ops</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">ptree_module_function</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="notation">(</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <span class="id" title="var">M1</span><span class="id" title="notation">)</span> <span class="id" title="notation">!</span> <span class="id" title="var">i</span>) <span class="id" title="keyword">as</span> [[|]|]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="get_module_function_transf_error"><span class="id" title="lemma">get_module_function_transf_error</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module"><span class="id" title="definition">transf_module</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">i</span>: <span class="id" title="definition">ident</span>) <span class="id" title="var">msg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_function</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">Error</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#msg"><span class="id" title="variable">msg</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_function</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">Error</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#msg"><span class="id" title="variable">msg</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">until</span> <span class="id" title="var">M2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span>  <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_eq_module&acute;_ok"><span class="id" title="lemma">transf_module_eq_module&acute;_ok</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module&acute;"><span class="id" title="definition">transf_module&acute;</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv_of_clight"><span class="id" title="definition">fenv_of_clight</span></a> <span class="id" title="var">M1</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_with_fenv"><span class="id" title="definition">transf_module_with_fenv</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">inv_monad</span> <span class="id" title="var">TRANSF</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="lemma">PTree.gmap_error_ok</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">i</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Transparent</span> <span class="id" title="instance">ptree_module_ops</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">ptree_module_function</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="notation">(</span><a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <span class="id" title="var">M1</span><span class="id" title="notation">)</span> <span class="id" title="notation">!</span> <span class="id" title="var">i</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span> <span class="id" title="keyword">as</span> [|]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> 1 <span class="id" title="keyword">as</span> [? [? <span class="id" title="var">HM2</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="get_module_variable_transf"><span class="id" title="lemma">get_module_variable_transf</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">M1</span> <span class="id" title="var">M2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module"><span class="id" title="definition">transf_module</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <span class="id" title="constructor">OK</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">i</span>: <span class="id" title="definition">ident</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_variable</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M2"><span class="id" title="variable">M2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">get_module_variable</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#M1"><span class="id" title="variable">M1</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="tactic">until</span> <span class="id" title="var">M2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span>  <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_eq_module&acute;_ok"><span class="id" title="lemma">transf_module_eq_module&acute;_ok</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module&acute;"><span class="id" title="definition">transf_module&acute;</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#fenv_of_clight"><span class="id" title="definition">fenv_of_clight</span></a> <span class="id" title="var">M1</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="mcertikos.layerlib.CompCertiKOS.html#transf_module_with_fenv"><span class="id" title="definition">transf_module_with_fenv</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">TRANSF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">inv_monad</span> <span class="id" title="var">TRANSF</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="lemma">PTree.gmap_error_ok</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">i</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Transparent</span> <span class="id" title="instance">ptree_module_ops</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">ptree_module_variable</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>